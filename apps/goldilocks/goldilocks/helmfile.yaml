repositories:
- name: fairwinds-stable
  url: https://charts.fairwinds.com/stable

releases:
- name: goldilocks
  namespace: goldilocks
  chart: fairwinds-stable/goldilocks
  version: 10.2.0
  values:
  - dashboard:
      flags:
        enable-cost: "false"
      ingress:
        enabled: true
        annotations:
          # https://k3d.io/v5.4.9/usage/exposing_services/
          ingress.kubernetes.io/ssl-redirect: "false"
        hosts:
        - host: goldilocks.local
          paths:
            - path: /
              type: ImplementationSpecific
        ingressClassName: traefik
  - vpa:
      fullnameOverride: vpa
      enabled: true
      admissionController:
        # https://github.com/kubernetes/autoscaler/issues/5318
        extraArgs:
          client-ca-file: /etc/tls-certs/ca.crt
          tls-cert-file: /etc/tls-certs/tls.crt
          tls-private-key: /etc/tls-certs/tls.key
        generateCertificate: false
        mutatingWebhookConfiguration:
          annotations:
            cert-manager.io/inject-ca-from: goldilocks/vpa-webhook-cert
        secretName: goldilocks-vpa-tls-secret

- name: vpa-webhook-cert
  namespace: goldilocks
  chart: ./vpa-webhook-cert
